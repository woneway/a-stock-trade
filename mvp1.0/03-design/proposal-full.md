# 提案：A股智能交易信号系统 MVP

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | A股智能交易信号系统 |
| 版本号 | V1.0 |
| 文档状态 | 初稿 |
| 创建日期 | 2026-02-20 |
| 产品负责人 | Lianwu |

---

## 2. 修订历史

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|----------|
| V1.0 | 2026-02-20 | Lianwu | 初版创建 |

---

## 3. 产品概述

### 3.1 项目背景

用户是一位有3年以上A股交易经验的个人投资者，目前采用人工操作模式：
- 在券商APP下单
- 手动将交易记录录入系统

用户希望通过系统化、自动化的方式，将多年积累的游资交易经验（尤其是炒股养家情绪周期等策略）转化为可复用的量化模型，每日输出买卖信号，辅助投资决策。

### 3.2 产品定位

**游资超短线交易辅助系统** —— 专注短线/超短线的复盘选股+盘中监控工具

### 3.3 核心场景

```
收盘后复盘(15:30) → 制定次日计划 → 盘中信号监控 → 人工执行 → 卖出 → 复盘
```

### 3.4 目标用户画像

| 维度 | 描述 |
|------|------|
| 投资经验 | 3年以上A股交易经验 |
| 交易风格 | 短线/超短线为主，偏好游资打法 |
| 持仓周期 | 1-3天为主，偶尔当日T+0 |
| 止损纪律 | -7%硬止损 |
| 止盈目标 | 5-10%+，涨停不板走 |
| 选股数量 | 每日5-10只目标股 |
| 资金规模 | 50万以下个人账户 |
| 技术能力 | 具备基本电脑操作能力 |

---

## 4. 现状与问题

### 4.1 当前流程

1. 人工复盘选股（耗时30分钟-1小时）
2. 在券商APP手动下单
3. 手动记录交易到Excel/笔记

### 4.2 痛点

| 痛点 | 描述 |
|------|------|
| 复盘效率低 | 每次需要手动查看大量股票数据 |
| 策略不成体系 | 交易经验难以系统化、复用 |
| 监控不及时 | 人工盯盘无法覆盖所有目标股 |
| 记录混乱 | 手动记录容易遗漏、错误 |
| 复盘困难 | 难以统计胜率、收益曲线 |

---

## 5. 产品目标

### 5.1 核心目标

| 目标 | 描述 | 成功指标 |
|------|------|----------|
| 提升选股效率 | 自动化策略扫描 | 选股时间从1小时缩短至5分钟 |
| 策略系统化 | 将游资经验转化为量化模型 | 支持4+策略模块 |
| 实时监控 | 盘中实时涨跌幅监控 | 到价提醒到达率>95% |
| 记录电子化 | 电子化交易记录 | 数据可追溯、可统计 |

### 5.2 业务目标

- 每日输出5-10只目标股
- 信号准确率目标（后续通过实盘验证）
- 胜率统计功能

---

## 6. 功能需求

### 6.1 功能清单

| 功能模块 | 功能点 | 优先级 | 描述 |
|----------|--------|--------|------|
| **交易计划** | 计划制定 | P0 | 从目标股转为交易计划，设置买卖价格 |
| | 止盈止损设置 | P0 | 设置止盈位、止损位 |
| | 验证条件设置 | P0 | 设置买入验证条件（如高开<3%） |
| | 交易时段控制 | P1 | 设置仅早盘/仅尾盘/全天可执行 |
| | 计划执行跟踪 | P0 | 跟踪计划执行状态 |
| | 计划复盘 | P1 | 计划 vs 实际对比 |
| **复盘模块** | 昨日涨停复盘 | P0 | 昨日涨停股今日表现，复盘溢价原因 |
| | 当日涨停复盘 | P0 | 按成交金额排序，复盘涨停原因 |
| | 炸板股复盘 | P1 | 复盘当日炸板股，避免下次踩坑 |
| | 龙虎榜复盘 | P1 | 跟踪大资金动向 |
| | 跌幅榜复盘 | P1 | 识别风险，回避跌停股 |
| | 板块轮动 | P0 | 识别热点板块、龙头股 |
| **数据监控** | 涨停板实时 | P0 | 实时涨停板列表 |
| | 短线精灵 | P1 | 16项异动指标 |
| **目标股池管理** | 每日策略扫描 | P0 | 收盘后自动/手动触发策略扫描 |
| | 目标股展示 | P0 | 按置信度排序展示5-10只目标股 |
| | 手动选股 | P0 | 按热点/涨幅/换手率手动筛选添加 |
| | 计划价格设置 | P0 | 设置计划买入价和仓位比例 |
| | 状态管理 | P0 | 跟踪目标股状态（待买入/已买入/已卖出/已放弃） |
| **持仓管理** | 持仓录入 | P0 | 手动录入持仓信息 |
| | 持仓展示 | P0 | 显示持仓、成本、盈亏 |
| | 分批建仓 | P1 | 支持试错仓+确认仓分批买入 |
| | 持仓统计 | P1 | 按数量/天数/盈亏状态分布 |
| **交易记录** | 交易录入 | P0 | 记录买入/卖出流水 |
| | 手续费计算 | P0 | 自动计算佣金、印花税 |
| | 交易筛选 | P1 | 按日期、股票、类型筛选 |
| | **交割单复盘** | P1 | 逐笔分析买卖点、胜败原因、反思总结 |
| **实时监控** | 涨跌幅监控 | P0 | 监控目标股实时涨跌幅 |
| | 到价提醒 | P0 | 到达计划价格时提醒 |
| | 卖点监控 | P1 | 止损/止盈提醒 |
| **数据看板** | 账户总览 | P0 | 可用资金、持仓市值、总资产 |
| | 收益曲线 | P1 | 近30日/90日收益曲线 |
| | 胜率统计 | P1 | 盈利/亏损笔数、胜率 |
| **策略配置** | 策略列表 | P1 | 显示所有策略及状态 |
| | 策略开关 | P1 | 启用/停用策略 |
| | 参数配置 | P2 | 调整策略参数 |

### 6.2 游资三种交易模式

游资核心有三种交易手法，系统需支持所有模式：

| 交易模式 | 入场时机 | 风险收益 | 核心技巧 |
|----------|----------|----------|----------|
| **低吸** | 强势股回调至均线企稳 | 低风险中等收益 | 只做强势回调、缩量企稳信号、分批建仓、下破10日线风控 |
| **半路** | 股票冲板途中介入 | 中风险中高收益 | 盘感要求高、需板块共振、量价配合 |
| **打板** | 涨停瞬间买入 | 高风险高收益 | 只打首位板/1进2/2进3、带动板块优先、放量分歧板 |

### 6.3 第一阶段策略

| 策略名称 | 交易模式 | 核心逻辑 | 优先级 |
|----------|----------|----------|--------|
| 情绪周期-冰点买入 | 低吸 | 市场冰点期（涨停数<30）寻找逆势抗跌股 | P0 |
| 龙头股回调 | 低吸 | 板块龙头回调至5日线企稳，缩量小K线信号 | P0 |
| KDJ金叉 | 低吸 | 日线KDJ金叉且K<30低位的买入信号 | P0 |
| 首板战法 | 打板 | 首次涨停且成交量放大，有板块带动效应 | P0 |
| 1进2打板 | 打板 | 集合竞价+量价信号，二封确定性最高 | P1 |
| 半路板 | 半路 | 冲击涨停途中介入，需板块共振 | P2 |
| 龙头股回调 | 动量 | 板块龙头股回调至5日线附近企稳 | P2 |

---

## 7. 用户流程

### 7.1 核心业务流程

```
┌─────────────────────────────────────────────────────────────┐
│  每日收盘后 15:30                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ 市场复盘     │  │ 策略选股     │  │ 目标股池     │   │
│  │ 涨停/板块/   │  │ 按策略扫描   │  │ 5-10只股票   │   │
│  │ 情绪周期     │  │ 全市场       │  │ 推荐理由     │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  次日盘中                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ 实时监控     │  │ 信号提醒     │  │ 人工执行     │   │
│  │ 目标股涨跌幅 │  │ 触及计划价  │  │ 券商APP买入  │   │
│  │              │  │ 卖点提醒     │  │ 手动录入     │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  卖出后/每日                                               │
│  ┌──────────────┐  ┌──────────────┐                      │
│  │ 手动录入     │  │ 盈亏计算     │                      │
│  │ 卖出记录     │  │ 胜率统计     │                      │
│  └──────────────┘  └──────────────┘                      │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 用户操作流程

1. **执行扫描**：点击"每日选股"，系统扫描全市场，输出目标股池
2. **设置计划**：为目标股设置计划买入价和仓位
3. **盘中监控**：开启实时监控，系统推送信号提醒
4. **人工执行**：收到提醒后，在券商APP操作
5. **回填记录**：操作完成后，在系统录入交易记录
6. **查看统计**：查看持仓、胜率、收益曲线

---

## 8. 页面结构

| 页面 | 路径 | 功能 | 优先级 |
|------|------|------|--------|
| 首页/Dashboard | / | 账户总览、持仓分布、近期信号 | P0 |
| 复盘 | /review | 游资每日复盘（涨停/炸板/龙虎榜） | P0 |
| 目标股池 | /pool | 每日选股结果 | P0 |
| **交易计划** | /plan | 制定/管理次日交易计划 | P0 |
| 持仓管理 | /positions | 当前持仓、盈亏情况、卖点设置 | P0 |
| 交易记录 | /trades | 历史买卖流水、筛选、统计 | P0 |
| 实时监控 | /monitor | 目标股实时涨跌幅、信号提醒 | P0 |
| 策略配置 | /config | 策略启用/停用、参数调整 | P1 |

---

## 8.1 WebUI 设计规范

### 8.1.1 设计原则

| 原则 | 说明 |
|------|------|
| **深色护眼** | 深色背景适合长时间盯盘，减少眼睛疲劳 |
| **信息密度高** | 游资需要快速获取信息，布局紧凑但不杂乱 |
| **涨跌色** | 红色=上涨，绿色=下跌（符合A股习惯） |
| **响应快速** | 数据实时刷新，操作即时反馈 |

### 8.1.2 配色方案

```
┌─────────────────────────────────────────────────────────────┐
│                    配色系统                                  │
├─────────────────────────────────────────────────────────────┤
│ 主色                                                          │
│   主背景    #0F172A    (深蓝黑)                            │
│   卡片背景  #1E293B    (灰蓝)                              │
│   次背景    #334155    (浅灰蓝)                            │
│                                                              │
│ 强调色                                                        │
│   主强调    #3B82F6    (蓝色) - 按钮、主要操作             │
│   次强调    #F97316    (橙色) - 警告、重点                 │
│                                                              │
│ 功能色                                                        │
│   上涨      #22C55E    (红色) - A股习惯                   │
│   下跌      #EF4444    (绿色) - A股习惯                   │
│   涨停      #DC2626    (深红)                              │
│   跌停      #16A34A    (深绿)                              │
│   持平      #94A3B8    (灰色)                              │
│                                                              │
│ 文本色                                                       │
│   主文本    #F8FAFC    (白色)                              │
│   次文本    #94A3B8    (灰色)                              │
│   弱文本    #64748B    (浅灰)                              │
└─────────────────────────────────────────────────────────────┘
```

### 8.1.3 布局结构

```
┌─────────────────────────────────────────────────────────────┐
│  顶部导航栏 (56px 高)                                       │
│  ┌────┬──────────────────────────────────────┬─────┬────┐  │
│  │Logo│  导航菜单                              │时间 │铃铛│  │
│  └────┴──────────────────────────────────────┴─────┴────┘  │
├────────────┬──────────────────────────────────────────────┤
│            │                                               │
│  侧边栏    │           主内容区域                            │
│  (200px)   │                                               │
│            │                                               │
│  - Dashboard│        根据页面内容变化                        │
│  - 复盘    │                                               │
│  - 目标股池 │                                              │
│  - 交易计划 │                                              │
│  - 持仓    │                                               │
│  - 交易记录 │                                              │
│  - 监控    │                                               │
│  - 配置    │                                               │
│            │                                               │
└────────────┴──────────────────────────────────────────────┘
```

### 8.1.4 组件规范

| 组件 | 样式 |
|------|------|
| **按钮** | 圆角8px，主按钮蓝色，次按钮灰色 |
| **卡片** | 圆角12px，背景#1E293B，轻微阴影 |
| **表格** | 深色表头，斑马纹，行hover高亮 |
| **输入框** | 圆角8px，深色背景，边框#334155 |
| **标签** | 圆角16px，小号字体 |
| **弹窗** | 居中，圆角16px，背景遮罩 |

### 8.1.5 字体规范

```
主字体:    Inter, system-ui, -apple-system, sans-serif
数字字体:  JetBrains Mono, SF Mono, monospace
字号:
  大标题   24px / 600
  标题     18px / 600
  副标题   14px / 500
  正文     14px / 400
  小字     12px / 400
  数字     16px / 500 (monospace)
```

---

## 8.5 交易计划模块（核心）

### 8.5.1 模块定位

交易计划是**游资交易的核心**，连接"选股"与"执行"。

```
目标股池 → 制定买入计划 → 制定卖出计划 → 盘中执行 → 卖出 → 复盘
```

### 8.5.2 买入计划要素

| 要素 | 说明 | 示例 |
|------|------|------|
| 股票 | 目标股票 | 600519 贵州茅台 |
| 计划买入价 | 计划买入价格 | 1680.00 |
| 仓位 | 计划仓位比例 | 10% |
| 交易模式 | 低吸/半路/打板 | 低吸 |
| 验证条件 | 买入前置条件 | 高开<3%，可买入 |
| 买入理由 | 为什么要买 | 龙头回调企稳 |
| 计划日期 | 计划执行日期 | 2026-02-21 |

### 8.5.2.1 买入时机技巧

| 时段 | 适用场景 | 说明 |
|------|----------|------|
| 早盘10:40前 | 打板/半路 | 观察开盘后态势，避免盲目追高 |
| 下午14:40后 | 低吸/尾盘 | 接近尾盘趋势明朗，规避盘中不确定性 |

### 8.5.2.2 分时图买点

| 买点类型 | 说明 | 适用模式 |
|----------|------|----------|
| 均价线支撑 | 冲高回落后，回调至均价线附近缩量企稳 | 低吸 |
| 开盘价支撑 | 回调至开盘价上方，缩量支撑 | 低吸 |
| 弱转强 | 开盘放量下跌后，缩量上穿均价线 | 半路 |
| 二封打板 | 炸板换手率超25%后回封 | 打板 |

### 8.5.3 卖出计划要素（核心）

游资卖出有**明确的纪律**，不是凭感觉卖。

#### 1. 止盈止损价格

| 要素 | 说明 | 示例 |
|------|------|------|
| 止损价 | 硬止损位 | 1562.00 (-7%) |
| 止盈价1 | 第一止盈位 | 1680.00 (+5%) |
| 止盈价2 | 第二止盈位 | 1740.00 (+10%) |

#### 2. 卖出条件（游资纪律）

| 类别 | 条件 | 触发动作 |
|------|------|----------|
| **止损** | 浮亏 ≤ -7% | 立即止损 |
| **止损** | 浮亏 ≤ -5% | 减半仓 |
| **止盈** | 浮盈 ≥ +5% | 卖1/3，锁部分利润 |
| **止盈** | 浮盈 ≥ +10% | 卖1/3，留1/3博更大 |
| **涨停板** | 涨停封板 | 持有到尾盘不板 |
| **涨停板** | 涨停开板 | 立即卖出或卖1/2 |
| **涨停板** | 涨停被砸 | 立即止损 |
| **板块走弱** | 板块涨幅 < 大盘 | 减半仓 |
| **板块走弱** | 龙头股下跌 > 5% | 跟随卖出 |
| **板块走弱** | 跟风股大跌 > 7% | 立即止损 |
| **技术卖点** | 跌破5日均线 | 减半仓 |
| **技术卖点** | 跌破10日均线 | 全部止损 |
| **技术卖点** | MACD死叉 | 减半仓 |
| **技术卖点** | 高位放量滞涨 | 立即卖出 |
| **大盘风险** | 大盘急跌 > 2% | 减半仓观望 |
| **大盘风险** | 大盘破位 | 全部止损 |
| **大盘风险** | 跌停数 > 30家 | 停止买入 |

#### 3. 卖出条件配置（用户可自定义启用/停用）

| 条件类型 | 默认状态 | 参数 |
|----------|----------|------|
| 止损-7% | 启用 | -7% |
| 止损-5% | 启用 | -5% |
| 止盈+5% | 启用 | +5% |
| 止盈+10% | 启用 | +10% |
| 涨停开板 | 启用 | 卖1/2 |
| 板块走弱 | 启用 | 板块涨幅<大盘 |
| 跌破5日线 | 停用 | - |
| 跌破10日线 | 停用 | - |

### 8.5.3.1 打板技巧（高阶）

| 技巧类型 | 说明 |
|----------|------|
| 只打首位板 | 打最早走出来的龙头 |
| 1进2/2进3 | 看谁卡位前排，谁先走出来就打谁 |
| 板块带动 | 有带动效应的优先 |
| 放量板 | 分歧转一致的过程，更安全 |
| 缩量板 | 3板容易走加速缩量板 |
| 不打首次封 | 打2封不打首次封，释放抛压后次日更强 |
| 不贪便宜 | 不到最后一档绝不买入，宁可排板 |
| 第二天纪律 | 无法封涨停必须出货，低于预期及时下车 |

### 8.5.3.2 低吸技巧（高阶）

| 技巧类型 | 说明 |
|----------|------|
| 只做强势股 | 前期有资金动作，连续涨停的才值得潜伏 |
| 健康回调三要素 | 不破位、不暴跌、不放量 |
| 企稳信号 | 小K线（十字星、小阳线、小阴线）+ 缩量 |
| 不抄急跌 | 急跌不抄底，等企稳再动手 |
| 分批建仓 | 第一次回踩小仓位试水，确认后加仓 |
| 下破10日线风控 | 跌破10日线必须止损 |

### 8.5.4 验证条件（买入前置）

| 条件类型 | 说明 |
|----------|------|
| 高开限制 | 高开<3%可买，高开>5%放弃 |
| 量能要求 | 成交量>1.5亿 |
| 大盘环境 | 上证>3000点可买 |
| 板块联动 | 板块涨幅>2% |
| 换手率 | 换手率>5% |
| 位置要求 | 涨幅<5%以内（不追高） |

### 8.5.5 计划状态

| 状态 | 说明 |
|------|------|
| 待执行 | 计划制定，等待次日执行 |
| 已执行 | 已买入，转为持仓 |
| 已放弃 | 放弃执行 |
| 已过期 | 未执行，已过日期 |

### 8.5.6 计划复盘

| 维度 | 说明 |
|------|------|
| 计划 vs 实际 | 对比计划买入价与实际成交价 |
| 卖点执行 | 哪些卖点执行了，哪些没执行 |
| 执行率 | 计划执行比例 |
| 胜率 | 计划盈利 vs 亏损 |
| 反思 | 记录本次操作的问题 |

---

## 8.6 复盘模块（游资核心习惯）

### 8.6.1 模块定位

复盘是游资每日必做工作，顶级游资复盘需要4-6小时。本系统将复盘流程系统化。

### 8.6.2 复盘流程（顶级游资标准）

```
┌─────────────────────────────────────────────────────────────┐
│                    每日复盘流程                              │
├─────────────────────────────────────────────────────────────┤
│ 1. 回顾当日操作                                            │
│    → 逐笔复盘买卖点、分析盈亏原因                           │
│    → 仓位管理是否合理                                       │
├─────────────────────────────────────────────────────────────┤
│ 2. 换手率选股                                              │
│    → 盯换手率排名前十的个股                                │
│    → 高换手=强关注度=大资金活跃                            │
│    → 换手率第一可能是陷阱，需结合板块判断                   │
├─────────────────────────────────────────────────────────────┤
│ 3. 板块晋级分析                                            │
│    → 盯"首板→二板"晋级路径                                 │
│    → 板块首板多且能晋级二板=资金有共识=持续性              │
│    → 首板多但晋级少=一日游=别碰                            │
├─────────────────────────────────────────────────────────────┤
│ 4. 昨日涨停今日表现                                        │
│    → 按成交金额排序，看大资金方向                           │
│    → 判断溢价，思考为什么买/没买                           │
├─────────────────────────────────────────────────────────────┤
│ 5. 当日涨停复盘                                            │
│    → 全部涨停股加入自选，分类到板块                        │
│    → 按金额排序，小成交不考虑（出货难）                    │
│    → 思考涨停原因，为什么没买                              │
├─────────────────────────────────────────────────────────────┤
│ 6. 炸板股复盘                                              │
│    → 复盘所有炸板股                                        │
│    → 思考下次如何避免                                      │
├─────────────────────────────────────────────────────────────┤
│ 7. 龙虎榜复盘                                              │
│    → 跟踪大资金动向                                        │
│    → 识别机构票 vs 游资票                                  │
├─────────────────────────────────────────────────────────────┤
│ 8. 跌停榜复盘                                              │
│    → 观察高换手+多个跌停=主力出货信号                      │
│    → 复盘跌5%以上股票，找出共性，回避风险                  │
├─────────────────────────────────────────────────────────────┤
│ 9. 制定次日策略                                            │
│    → 潜在买入标的、卖出时机、仓位管理                      │
└─────────────────────────────────────────────────────────────┘
```

### 8.6.3 复盘页面功能

| 功能 | 说明 |
|------|------|
| **交割单复盘** | 逐笔分析买卖点、盈亏原因、反思总结 |
| **换手率排行** | 换手率前10，识别资金活跃股 |
| **板块晋级** | 首板→二板晋级分析 |
| **昨日涨停表现** | 昨日涨停股今日涨跌、溢价、封单变化 |
| **当日涨停板** | 按金额排序，显示涨停原因、封单、换手率 |
| **炸板股列表** | 当日炸板股，思考为何被砸 |
| **龙虎榜** | 机构/游资资金动向 |
| **跌幅榜** | 跌5%以上股票，共性分析 |
| **板块轮动** | 今日热点板块，板块生命周期 |
| **连板梯度** | 3板/2板/1板数量，亏钱效应位置 |

### 8.6.4 数据展示

| 数据项 | 说明 |
|--------|------|
| 涨停股 | 代码、名称、涨停时间、封单量、换手率、涨停原因 |
| 炸板股 | 代码、名称、炸板时间、当时涨幅、原因 |
| 龙虎榜 | 买入营业部、卖出营业部、净额 |
| 板块 | 板块名称、涨停数、领涨股、热度变化 |

### 8.6.5 游资复盘习惯对比

| 习惯 | 本系统支持 |
|------|------------|
| 回顾当日操作 | ✅ 交割单复盘 |
| 换手率选股 | ✅ |
| 板块晋级分析 | ✅ |
| 昨日涨停今日表现 | ✅ 自动获取 |
| 按金额排序 | ✅ |
| 思考为什么买/没买 | ✅ 记录在备注 |
| 炸板股复盘 | ✅ |
| 龙虎榜跟踪 | ✅ |
| 跌停榜风险识别 | ✅ |
| 板块分类 | ✅ |
| 交割单复盘 | ✅ 交易记录页 |
| 资金曲线 | ✅ 数据看板 |

---

## 9. 技术方案

### 9.1 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 后端框架 | Python FastAPI | 现代化、高性能 |
| 数据库 | SQLite | 本地存储、零配置 |
| ORM | SQLAlchemy | 数据访问抽象 |
| 数据源 | akshare | 免费A股数据接口 |
| 前端框架 | React 18 + TypeScript | 现代化前端框架 |
| 构建工具 | Vite | 快速构建 |
| 样式 | Tailwind CSS | 原子化CSS |
| 路由 | React Router | SPA路由 |
| 图表 | Recharts | 数据可视化 |
| HTTP客户端 | Axios | API通信 |

### 9.2 项目结构

```
项目根目录/
├── backend/                 # 后端
│   ├── src/
│   │   ├── api/           # API路由
│   │   ├── services/      # 业务逻辑
│   │   ├── repos/         # 数据访问
│   │   ├── models/        # 数据模型
│   │   ├── strategies/    # 策略实现
│   │   └── main.py        # 入口
│   ├── requirements.txt
│   └── .env
│
├── frontend/               # 前端
│   ├── src/
│   │   ├── components/   # 通用组件
│   │   ├── pages/        # 页面组件
│   │   ├── hooks/        # 自定义Hook
│   │   ├── services/     # API服务
│   │   ├── types/        # TypeScript类型
│   │   └── App.tsx       # 入口
│   ├── index.html
│   ├── package.json
│   └── vite.config.ts
│
└── data/                  # 数据
    └── stock.db           # SQLite数据库
```

### 9.3 API设计

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/scan | 执行策略扫描 |
| GET | /api/pool | 获取目标股池 |
| POST | /api/pool | 添加目标股 |
| PUT | /api/pool/{id} | 更新目标股 |
| DELETE | /api/pool/{id} | 删除目标股 |
| GET | /api/plan | 获取交易计划列表 |
| POST | /api/plan | 创建交易计划 |
| PUT | /api/plan/{id} | 更新交易计划 |
| DELETE | /api/plan/{id} | 删除交易计划 |
| POST | /api/plan/{id}/execute | 执行计划（转为持仓） |
| GET | /api/positions | 获取持仓列表 |
| POST | /api/positions | 添加持仓 |
| PUT | /api/positions/{id} | 更新持仓 |
| DELETE | /api/positions/{id} | 删除持仓 |
| GET | /api/trades | 获取交易记录 |
| POST | /api/trades | 添加交易记录 |
| GET | /api/config/strategies | 获取策略配置 |
| PUT | /api/config/strategies/{name} | 更新策略配置 |
| GET | /api/monitor/quotes | 获取实时行情 |
| GET | /api/review/limit-up | 获取当日涨停板 |
| GET | /api/review/limit-up-yesterday | 获取昨日涨停表现 |
| GET | /api/review/broken-limit | 获取当日炸板股 |
| GET | /api/review/dragon-tiger | 获取龙虎榜 |
| GET | /api/review/limit-down | 获取当日跌停板 |
| GET | /api/review/sector-rotation | 获取板块轮动数据 |
| GET | /api/dashboard/summary | 获取账户概览 |

---

## 9.4 数据获取模块

### 9.4.1 数据类型需求

| 数据类型 | 用途 | 数据源 | 更新频率 |
|----------|------|--------|----------|
| 实时行情 | 盘中监控、涨跌幅提醒 | akshare | 实时/分钟级 |
| 日K线数据 | 策略计算、K线图表 | akshare | 每日收盘后 |
| 5分钟/15分钟K线 | 分时图分析、盘中信号 | akshare | 盘中实时 |
| 涨停板数据 | 复盘、选股 | akshare | 每日收盘后 |
| 炸板股数据 | 复盘分析 | akshare | 每日收盘后 |
| 龙虎榜数据 | 大资金跟踪 | akshare | 每日收盘后 |
| 板块数据 | 板块轮动、热点分析 | akshare | 每日收盘后 |
| 财务数据 | 基本面筛选 | akshare | 季度更新 |
| 大盘指数 | 大盘环境判断 | akshare | 实时 |

### 9.4.2 akshare 接口映射

| 功能 | akshare 函数 | 说明 |
|------|--------------|------|
| 实时行情 | `stock_zh_a_spot_em` | 全市场实时行情 |
| 日K线 | `stock_zh_a_hist` | 个股历史K线 |
| 分时数据 | `stock_zh_a_minute` | 个股分时数据 |
| 涨停板 | `stock_zh_a_limit_up` | 当日涨停板 |
| 跌停板 | `stock_zh_a_limit_down` | 当日跌停板 |
| 炸板股 | `stock_zh_a_limit_up_em` | 涨停板(含炸板) |
| 龙虎榜 | `stock_lhb_detail_em` | 龙虎榜详情 |
| 板块行情 | `stock_board_industry_name_em` | 板块行情 |
| 大盘指数 | `index_zh_a_spot` | 指数实时行情 |
| 资金流向 | `stock_individual_fund_flow` | 个股资金流向 |
| 融资融券 | `stock_margin_detail` | 融资融券数据 |

### 9.4.3 数据缓存策略

```
┌─────────────────────────────────────────────────────────────┐
│                    数据缓存架构                               │
├─────────────────────────────────────────────────────────────┤
│  内存缓存 (Memory)                                          │
│    ├── 实时行情: 60秒过期                                   │
│    ├── 涨停板: 5分钟过期                                    │
│    └── 板块数据: 5分钟过期                                  │
├─────────────────────────────────────────────────────────────┤
│  本地缓存 (SQLite)                                           │
│    ├── 日K线: 每日收盘后更新                                 │
│    ├── 历史数据: 永久保留                                    │
│    └── 策略结果: 每日覆盖                                   │
├─────────────────────────────────────────────────────────────┤
│  降级策略                                                    │
│    ├── 网络失败: 返回缓存数据 + 提示                         │
│    ├── 限流: 增加延迟重试                                   │
│    └── 数据异常: 记录日志 + 跳过                             │
└─────────────────────────────────────────────────────────────┘
```

### 9.4.4 数据请求频率控制

| 接口 | 频率限制 | 策略 |
|------|----------|------|
| 实时行情 | 60次/分 | 每只股票60秒内不重复请求 |
| 日K线 | 100次/分 | 批量请求+缓存 |
| 涨停板 | 10次/分 | 收盘后请求一次 |
| 龙虎榜 | 10次/分 | 收盘后请求一次 |

---

## 9.5 策略模块

### 9.5.1 策略框架设计

```python
class BaseStrategy:
    name: str           # 策略名称
    enabled: bool       # 是否启用
    priority: int       # 优先级(1-10)
    
    def scan(self, stocks: List[Stock]) -> List[Signal]:
        """扫描全市场，返回信号列表"""
        pass
    
    def filter(self, stock: Stock) -> bool:
        """过滤条件"""
        pass
    
    def calculate_confidence(self, stock: Stock) -> float:
        """计算置信度(0-1)"""
        pass
    
    def get_signal_reason(self, stock: Stock) -> str:
        """信号原因描述"""
        pass
```

### 9.5.2 策略接口规范

```python
@dataclass
class TradingSignal:
    stock_code: str           # 股票代码
    stock_name: str           # 股票名称
    strategy_name: str        # 策略名称
    signal_type: SignalType  # BUY/SELL/HOLD
    confidence: float        # 置信度 0-1
    price: float             # 当前价格
    reason: str              # 信号原因
    created_at: datetime     # 创建时间
    
    # 买入相关(仅BUY)
    target_price: float      # 目标买入价
    stop_loss: float         # 止损价
    position_ratio: float    # 推荐仓位
    
    # 技术指标
    indicators: Dict         # KDJ/MACD/RSI等
```

### 9.5.3 MVP阶段策略实现

| 策略名称 | 交易模式 | 核心逻辑 | 触发条件 | 优先级 |
|----------|----------|----------|----------|--------|
| 情绪周期-冰点 | 低吸 | 市场冰点期寻找逆势抗跌股 | 涨停数<30且跌幅<3% | P0 |
| 龙头股回调 | 低吸 | 板块龙头回调企稳 | 回调至5日线+缩量小K | P0 |
| KDJ金叉 | 低吸 | KDJ低位金叉 | K<30金叉 | P0 |
| 首板战法 | 打板 | 首次涨停且有板块带动 | 首板+放量+板块联动 | P0 |
| 1进2打板 | 打板 | 二板确认 | 昨日首板+今日高开 | P1 |
| 放量突破 | 半路 | 放量突破前高 | 突破量>1.5倍均量 | P1 |

### 9.5.4 策略扫描流程

```
┌─────────────────────────────────────────────────────────────┐
│                    策略扫描流程                              │
├─────────────────────────────────────────────────────────────┤
│  1. 获取全市场股票列表                                       │
│     └── stock_zh_a_spot_em (约5000只)                      │
├─────────────────────────────────────────────────────────────┤
│  2. 获取所需历史数据                                         │
│     └── 并行获取近60日K线                                   │
├─────────────────────────────────────────────────────────────┤
│  3. 并行执行各策略                                           │
│     ├── 情绪周期: 全市场扫描 → 选出逆势股                   │
│     ├── 龙头回调: 获取板块龙头 → 回调检测                    │
│     ├── KDJ金叉: 计算KDJ → 金叉检测                         │
│     └── 首板: 涨停板数据 → 过滤首板                         │
├─────────────────────────────────────────────────────────────┤
│  4. 信号聚合与排序                                           │
│     ├── 去重(同一股票多策略触发)                             │
│     └── 按置信度排序                                         │
├─────────────────────────────────────────────────────────────┤
│  5. 输出目标股池                                             │
│     └── 存储到数据库 + 推送到前端                           │
└─────────────────────────────────────────────────────────────┘
```

### 9.5.5 技术指标计算

| 指标 | 计算方法 | 用途 |
|------|----------|------|
| MA5/10/20 | 移动平均 | 趋势判断、均线支撑 |
| KDJ | 随机指标 | 超买超卖、金叉死叉 |
| MACD | 指数平滑异同移动平均线 | 趋势判断、背离 |
| RSI | 相对强弱指标 | 超买超卖 |
| 成交量 | 成交额/价格 | 量价配合 |
| 换手率 | 成交股数/流通股本 | 资金活跃度 |

---

## 9.6 风控模块

### 9.6.1 风控规则体系

```
┌─────────────────────────────────────────────────────────────┐
│                    风控规则层级 │
├─────────────────────────────────────────────────────────────┤
│  第一层: 系统级风控                                          │
│                                 ├── 大盘风险: 跌停数>30家 → 停止买入                     │
│    ├── 大盘破位: 大盘跌幅>2% → 减仓观望                    │
│    └── 市场狂热: 涨停数>200 → 谨慎追高                      │
├─────────────────────────────────────────────────────────────┤
│  第二层: 持仓级风控                                          │
│    ├── 单股止损: -7%硬止损                                  │
│    ├── 单股止盈: +5%卖1/3, +10%卖1/3                       │
│    ├── 仓位控制: 单股≤20%, 总仓≤80%                        │
│    └── 持股数量: 每日≤5只                                   │
├─────────────────────────────────────────────────────────────┤
│  第三层: 交易级风控                                          │
│    ├── 买入验证: 高开<3%、量能>1.5亿                        │
│    ├── 卖出纪律: 涨停开板必走                               │
│    └── 模式限制: 不熟悉模式不做                              │
└─────────────────────────────────────────────────────────────┘
```

### 9.6.2 风控配置

| 规则项 | 默认值 | 可调整 | 说明 |
|--------|--------|--------|------|
| 单股止损比例 | -7% | 是 | 硬止损线 |
| 单股止盈比例1 | +5% | 是 | 第一止盈位 |
| 单股止盈比例2 | +10% | 是 | 第二止盈位 |
| 单股最大仓位 | 20% | 是 | 单只股票最高仓位 |
| 总仓位上限 | 80% | 是 | 账户总仓位上限 |
| 持股数量上限 | 5只 | 是 | 每日持股数量 |
| 跌停数阈值 | 30家 | 是 | 触发停止买入 |
| 大盘跌幅阈值 | 2% | 是 | 触发减仓观望 |

### 9.6.3 风险预警机制

| 风险类型 | 触发条件 | 提醒方式 | 处理建议 |
|----------|----------|----------|----------|
| 止损预警 | 浮亏≥-5% | 橙色通知 | 准备减仓 |
| 止损触发 | 浮亏≤-7% | 红色通知+声音 | 立即止损 |
| 止盈提醒 | 浮盈≥+5% | 蓝色通知 | 考虑卖出 |
| 大盘风险 | 跌停数>30 | 红色通知 | 停止买入 |
| 板块走弱 | 板块跌幅<-3% | 橙色通知 | 考虑减仓 |
| 涨停开板 | 封单减少>50% | 红色通知 | 立即卖出 |

### 9.6.4 卖出纪律自动化

```python
class SellDiscipline:
    """卖出纪律执行器"""
    
    def check_conditions(self, position: Position, market: MarketData) -> List[SellSignal]:
        signals = []
        
        # 1. 止损检查
        if position.profit_ratio <= -0.07:
            signals.append(SellSignal(FORCE_SELL, "止损-7%"))
        elif position.profit_ratio <= -0.05:
            signals.append(SellSignal(REDUCE_HALF, "减半仓-5%"))
        
        # 2. 止盈检查
        if position.profit_ratio >= 0.10:
            signals.append(SellSignal(SELL_ONE_THIRD, "止盈+10%"))
        elif position.profit_ratio >= 0.05:
            signals.append(SellSignal(SELL_ONE_THIRD, "止盈+5%"))
        
        # 3. 涨停检查
        if position.is_limit_up and not position.is_sealed:
            signals.append(SellSignal(CHECK_SELL, "涨停开板"))
        
        # 4. 板块走弱
        if position.sector_decline > 0.03:
            signals.append(SellSignal(REDUCE_HALF, "板块走弱"))
        
        return signals
```

---

## 9.7 数据库设计

### 9.7.1 核心表结构

```sql
-- 目标股池
CREATE TABLE target_pool (
    id INTEGER PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50),
    strategy_name VARCHAR(50),
    confidence FLOAT,
    target_price FLOAT,
    stop_loss_price FLOAT,
    position_ratio FLOAT,
    reason TEXT,
    status VARCHAR(20) DEFAULT 'pending',
    scan_date DATE,
    created_at DATETIME,
    updated_at DATETIME
);

-- 持仓
CREATE TABLE positions (
    id INTEGER PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50),
    quantity INTEGER,
    cost_price FLOAT,
    current_price FLOAT,
    profit_ratio FLOAT,
    stop_loss_price FLOAT,
    take_profit_1 FLOAT,
    take_profit_2 FLOAT,
    status VARCHAR(20) DEFAULT 'holding',
    opened_at DATE,
    created_at DATETIME,
    updated_at DATETIME
);

-- 交易记录
CREATE TABLE trades (
    id INTEGER PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50),
    trade_type VARCHAR(10) NOT NULL,
    quantity INTEGER,
    price FLOAT,
    amount FLOAT,
    fee FLOAT,
    trade_date DATE,
    notes TEXT,
    created_at DATETIME
);

-- 交易计划
CREATE TABLE trading_plans (
    id INTEGER PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50),
    plan_date DATE NOT NULL,
    target_price FLOAT,
    position_ratio FLOAT,
    trade_mode VARCHAR(20),
    validation_conditions TEXT,
    stop_loss_price FLOAT,
    take_profit_1 FLOAT,
    take_profit_2 FLOAT,
    status VARCHAR(20) DEFAULT 'pending',
    notes TEXT,
    created_at DATETIME,
    updated_at DATETIME
);

-- 策略配置
CREATE TABLE strategy_config (
    id INTEGER PRIMARY KEY,
    name VARCHAR(50) UNIQUE,
    enabled BOOLEAN DEFAULT 1,
    priority INT DEFAULT 5,
    params TEXT,
    created_at DATETIME,
    updated_at DATETIME
);

-- 风控配置
CREATE TABLE risk_config (
    id INTEGER PRIMARY KEY,
    config_key VARCHAR(50) UNIQUE,
    config_value FLOAT,
    description VARCHAR(200),
    updated_at DATETIME
);
```

---

## 9.8 实时监控架构

### 9.8.1 监控流程

```
┌─────────────────────────────────────────────────────────────┐
│                    实时监控架构                              │
├─────────────────────────────────────────────────────────────┤
│  前端 WebSocket                                              │
│     └── 连接 /ws/monitor                                    │
├─────────────────────────────────────────────────────────────┤
│  后端轮询服务 (每60秒)                                       │
│     ├── 获取目标股实时行情                                   │
│     ├── 计算涨跌幅                                           │
│     ├── 检查风控规则                                         │
│     └── 推送消息到WebSocket                                 │
├─────────────────────────────────────────────────────────────┤
│  提醒服务                                                    │
│     ├── 桌面通知 (Browser Notification)                     │
│     ├── 页面内通知 (Toast)                                   │
│     └── 声音提醒 (可选)                                      │
└─────────────────────────────────────────────────────────────┘
```

### 9.8.2 监控数据项

| 数据项 | 更新频率 | 说明 |
|--------|----------|------|
| 实时价格 | 60秒 | 当前成交价 |
| 涨跌幅 | 60秒 | 今日涨跌幅 |
| 涨跌额 | 60秒 | 今日涨跌额 |
| 成交量 | 60秒 | 成交数量 |
| 金额 | 60秒 | 成交金额 |
| 换手率 | 60秒 | 换手率 |
| 封单量 | 30秒 | 涨停板封单(涨停时) |

---



## 10. 非功能需求

### 10.1 性能需求

| 指标 | 要求 |
|------|------|
| 数据更新 | 每日15:30自动更新，30分钟内完成全市场 |
| 信号生成 | 扫描全市场 < 5分钟 |
| API响应 | < 1秒 |
| 前端加载 | < 3秒 |

### 10.2 可用性

- 支持 Windows/macOS/Linux
- Python 3.9+
- 无需外网可查看历史数据（首次需联网）

### 10.3 扩展性

- 策略模块采用插件式设计
- 数据源可替换

---

## 11. 风险与预案

| 风险 | 影响 | 预案 |
|------|------|------|
| 数据源不稳定 | 信号生成失败 | 多数据源备份，本地缓存 |
| 策略过拟合 | 实盘效果差 | 保守参数，实盘验证 |
| API限速 | 数据获取慢 | 增加间隔，优化请求 |
| 资金规模限制 | 大资金无法操作 | 定位50万以下小账户 |

---

## 12. 里程碑

| 版本 | 功能 | 时间 |
|------|------|------|
| MVP | 收盘后选股 + 目标股池 + Web界面 | 2周 |
| V1.0 | 盘中实时监控 + 涨跌幅提醒 + 卖点监控 | 1个月 |
| V1.1 | 短线精灵 + 持仓管理 + 胜率统计 | 1.5个月 |

---

## 13. 名词解释

| 术语 | 定义 |
|------|------|
| 冰点期 | 市场情绪低迷，涨停家数 < 30 |
| 金叉 | K线从下向上穿越D线 |
| 死叉 | K线从上向下穿越D线 |
| 首板 | 个股当日首次涨停 |
| 龙头股 | 板块中涨幅/影响力最大的股票 |
| 置信度 | 策略信号的可靠程度（0-1） |
| 目标股池 | 每日策略选出的待买入股票列表 |
| 交易计划 | 次日交易的具体计划，包含买卖价格、止盈止损 |
| 验证条件 | 买入前置条件，如高开<3% |
| 计划执行 | 将交易计划转为持仓的过程 |

---

## 14. 能力划分：自建 vs 外部集成

### 14.1 量化交易系统能力矩阵

| 能力模块 | 能力项 | 自建 | 外部集成 | 说明 |
|----------|--------|:----:|:--------:|------|
| **数据层** | 实时行情数据 | | ✅ | akshare免费接口 |
| | 历史K线数据 | | ✅ | akshare |
| | 涨停/跌停数据 | | ✅ | akshare |
| | 板块/题材数据 | | ✅ | akshare |
| | 财务/基本面数据 | | ✅ | akshare |
| | Level2行情 | | ❌ | 需要付费，MVP暂不涉及 |
| **策略层** | 策略引擎框架 | ✅ | | 自建插件化架构 |
| | KDJ/MA/MACD指标 | ✅ | | 自建技术指标库 |
| | 情绪周期分析 | ✅ | | 自建（核心差异化） |
| | 涨停板识别 | ✅ | | 自建 |
| | 策略回测 | ✅ | | 自建基础回测 |
| | AI策略（LLM） | | ⚙️ | 后期可选集成 |
| **执行层** | 券商交易API | | ❌ | 不做，券商有人工操作 |
| | 订单管理 | | ❌ | 不做 |
| | 成交确认 | | ❌ | 手动录入 |
| **风控层** | 止损/止盈监控 | ✅ | | 自建 |
| | 仓位管理 | ✅ | | 自建 |
| | 风险预警 | ✅ | | 自建 |
| **展示层** | Web界面 | ✅ | | 自建 |
| | 实时监控面板 | ✅ | | 自建 |
| | 收益曲线图表 | ✅ | | Recharts |
| | 桌面通知 | ✅ | | Browser Notification API |
| **存储层** | 交易数据存储 | ✅ | | SQLite本地 |
| | 缓存 | ✅ | | 内存缓存 |
| | 数据备份 | | ⚙️ | 云盘/本地手动 |

### 14.2 外部服务选型

| 服务类型 | 推荐方案 | 选型理由 |
|----------|----------|----------|
| **行情数据** | akshare | 完全免费，数据较全，更新快 |
| **备选数据源** | baostock | 作为备份，数据质量高 |
| **图表库** | Recharts | React生态，TS支持 |
| **HTTP客户端** | Axios | React生态标配 |
| **ORM** | SQLAlchemy | Python生态，SQLite适配好 |

### 14.3 不集成的服务

| 服务 | 原因 |
|------|------|
| **券商API/QMT/PTrade** | 用户需求是人工操作，不需要自动交易 |
| **Level2行情** | 个人投资者不需要，费用高 |
| **Wind/Choice** | 费用高，个人用户不需要 |
| **量化平台（聚宽/掘金）** | 需要实盘接口，我们不做自动交易 |

### 14.4 MVP阶段核心自建能力

```
┌─────────────────────────────────────────────────────────────┐
│                     自建核心能力                            │
├─────────────────────────────────────────────────────────────┤
│  1. 策略引擎框架                                           │
│     - 插件化策略加载                                       │
│     - 多策略并行扫描                                       │
│     - 信号聚合与排序                                        │
│                                                              │
│  2. 技术指标计算库                                          │
│     - KDJ/MACD/RSI/MA                                     │
│     - 涨停板识别                                           │
│     - 量价关系分析                                          │
│                                                              │
│  3. 情绪周期模块                                           │
│     - 涨停数量统计                                          │
│     - 板块轮动分析                                          │
│     - 冰点/高潮判断                                         │
│                                                              │
│  4. 游资复盘模块                                           │
│     - 涨停板/炸板股数据                                     │
│     - 龙虎榜跟踪                                            │
│     - 板块轮动可视化                                        │
│                                                              │
│  5. 交易计划管理                                           │
│     - 计划价格/止盈止损设置                                 │
│     - 验证条件                                              │
│     - 计划执行跟踪                                          │
│                                                              │
│  6. Web界面                                                │
│     - 7个核心页面                                          │
│     - 实时涨跌幅监控                                        │
│     - 桌面通知                                              │
└─────────────────────────────────────────────────────────────┘

### 14.5 后期可选扩展能力

| 能力 | 说明 | 优先级 |
|------|------|--------|
| 策略回测系统 | 基于历史数据回测策略效果 | P2 |
| 多数据源切换 | 增强数据稳定性 | P2 |
| 策略组合优化 | 多策略加权 | P2 |
| AI选股助手 | 基于LLM的选股建议 | P3 |
| 微信/邮件通知 | 增强提醒渠道 | P3 |
| 移动端 | React Native小程序 | P3 |

---

## 15. 券商接口说明

### 15.1 本系统定位

**不做券商API对接**，原因：
1. 用户需求是人工操作，不需要自动交易
2. 券商API需要50万+资金门槛
3. 券商接口不稳定，维护成本高
4. 人工操作更符合游资交易习惯

### 15.2 人工操作流程

```
系统推荐 → 用户确认 → 券商APP下单 → 系统录入 → 完成
```

### 15.3 未来可选集成

如后续需要可考虑：
- **miniQMT**（10万门槛）：国金证券
- **PTrade**（50万门槛）：多数券商支持
- **QMT**（50万门槛）：多数券商支持

但MVP阶段不涉及。

---

*文档版本：V1.0*
*最后更新：2026-02-20*
