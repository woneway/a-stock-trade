# 基于策略的交易落地方案

本文档结合当前交易系统和游资常用APP，提供完整的交易落地实施计划。

---

## 一、当前系统功能概述

### 1.1 现有功能模块

| 模块 | 功能 | 状态 |
|-----|------|------|
| 策略管理 | 8大核心要素策略创建与编辑 | 已完成 |
| 策略扫描 | 根据策略条件匹配股票 | 已完成 |
| 交易计划 | 创建、执行交易计划 | 已完成 |
| 持仓管理 | 持仓跟踪与联动 | 已完成 |
| 交易记录 | 买卖记录 | 已完成 |
| 今日计划 | 当日交易计划展示 | 已完成 |
| 仪表盘 | 市场概览 | 已完成 |

### 1.2 策略8大核心要素（已实现）

1. **模式定位**：打板/低吸/半路/尾盘
2. **情绪周期仓位**：上升/震荡/下降/混沌仓位配置
3. **选股逻辑**：板块、题材、基本面
4. **介入时机**：具体买入条件
5. **卖出策略**：止盈止损条件
6. **仓位管理**：持仓数量、单票仓位
7. **场景应对**：不同行情的应对
8. **执行纪律**：交易纪律

---

## 二、系统架构设计

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                      数据层                                  │
├──────────────┬──────────────┬──────────────┬──────────────┤
│  AkShare API │  开盘啦APP   │  短线王APP   │  同花顺Level2 │
│  (免费数据)   │  (游资数据)  │  (AI选股)    │  (高级行情)   │
└──────┬───────┴──────┬───────┴──────┬───────┴──────┬───────┘
       │               │               │               │
       ▼               ▼               ▼               ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据中台 (Python Backend)                 │
├─────────────────────────────────────────────────────────────┤
│  • 实时行情抓取     • 情绪周期计算    • 板块效应分析      │
│  • 龙虎榜数据处理    • 游资席位追踪    • 策略条件匹配      │
│  • 资金流向分析      • 预警触发        • 信号推送          │
└─────────────────────────────────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────┐
│                    业务逻辑层                                │
├─────────────────────────────────────────────────────────────┤
│  • 策略管理          • 计划执行        • 持仓管理          │
│  • 交易记录          • 风险控制        • 绩效分析          │
└─────────────────────────────────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────┐
│                    展示层 (Frontend)                         │
├─────────────────────────────────────────────────────────────┤
│  • 仪表盘            • 策略管理        • 交易计划          │
│  • 策略扫描          • 持仓/交易       • 设置/告警         │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 数据流向

```
盘前 (9:00前)
├── 开盘啦：获取隔夜消息、题材发酵
├── 同花顺：获取隔夜外盘、期货走势
└── 系统：生成当日策略候选股

盘中 (9:30-15:00)
├── AkShare：实时行情数据
├── 开盘啦：竞价异动监控
├── 短线王：AI选股信号
└── 系统：策略扫描、预警推送

盘后 (15:00-17:00)
├── 开盘啦：复盘数据、龙虎榜分析
├── 同花顺：涨停分析
└── 系统：更新持仓、记录交易、生成次日计划

晚间 (20:00-22:00)
├── 开盘啦：游资动向分析
├── 短线王：AI次日推荐
└── 系统：策略复盘、计划制定
```

---

## 三、数据获取方案

### 3.1 数据来源对比

| 数据类型 | 免费方案 | 付费方案 |
|---------|---------|---------|
| 实时行情 | AkShare | 开盘啦会员 / 同花顺Level 2 |
| 涨停板 | AkShare | 开盘啦实时涨停 |
| 资金流向 | AkShare | 开盘啦主力资金 |
| 龙虎榜 | AkShare | 开盘啦深度龙虎榜 |
| 板块资金 | AkShare | 开盘啦板块强度 |
| 竞价数据 | - | 开盘啦竞价系统 |
| 游资追踪 | - | 开盘啦游资组合 |
| 盘口数据 | - | 同花顺Level 2 |
| 技术指标 | 自计算/TA-Lib | 麦蕊智数API |

### 3.2 推荐配置

**方案一：轻量级（个人投资者）**
- AkShare（免费）
- 开盘啦（免费版）
- 同花顺（免费版）
- 成本：0元

**方案二：进阶版（推荐）**
- AkShare（免费）
- 开盘啦会员（约300元/年）
- 同花顺Level 2（约200元/年）
- 成本：约500元/年

**方案三：专业版**
- AkShare + Tushare Pro
- 开盘啦会员 + 短线王会员
- 同花顺Level 2
- 成本：约2000元/年

---

## 四、功能增强方案

### 4.1 情绪周期模块

**新增功能：**

| 功能 | 数据来源 | 说明 |
|-----|---------|------|
| 涨停数量统计 | AkShare | 实时统计当日涨停/跌停 |
| 炸板率计算 | 自计算 | (炸板数/涨停总数)×100% |
| 连板高度 | AkShare | 当前市场最高板 |
| 情绪阶段判断 | 自计算 | 冰点/启动/发酵/高潮/退潮 |
| 赚钱/亏钱效应 | AkShare | 资金流向统计 |

**实现方式：**

```python
# backend/app/services/sentiment.py
import akshare as ak

def get_market_sentiment():
    """获取市场情绪数据"""
    # 涨停数量
    limit_up = ak.stock_zh_a_limit_up_em()
    limit_down = ak.stock_zh_a_limit_down_em()

    # 炸板率计算（需获取历史数据对比）
    # ...

    # 判断情绪阶段
    limit_count = len(limit_up)
    if limit_count < 10:
        sentiment = "冰点期"
    elif limit_count < 30:
        sentiment = "启动期"
    elif limit_count < 60:
        sentiment = "发酵期"
    elif limit_count >= 60:
        sentiment = "高潮期"
    else:
        sentiment = "混沌期"

    return {
        "涨停数": limit_count,
        "跌停数": len(limit_down),
        "情绪阶段": sentiment
    }
```

### 4.2 板块效应模块

**新增功能：**

| 功能 | 数据来源 | 说明 |
|-----|---------|------|
| 板块涨停统计 | AkShare | 各板块涨停数量 |
| 板块资金流向 | AkShare | 主力资金净流入 |
| 板块强度排行 | 开盘啦 | 付费更准 |
| 板块轮动 | 自计算 | 每日轮动分析 |

### 4.3 游资追踪模块

**新增功能：**

| 功能 | 数据来源 | 说明 |
|-----|---------|------|
| 龙虎榜数据 | AkShare | 当日上榜股票 |
| 营业部排行 | AkShare | 上榜次数/资金实力 |
| 游资席位追踪 | 开盘啦 | 50+游资组合 |
| 游资操作历史 | 开盘啦 | 历史操作记录 |

**实现方式：**

```python
# backend/app/services/lhb.py
import akshare as ak

def get_lhb_data(date):
    """获取龙虎榜数据"""
    return ak.stock_lhb_detail_em(start_date=date)

def get_yyb_rank():
    """获取营业部排行"""
    yyb_most = ak.stock_lh_yyb_most()
    yyb_capital = ak.stock_lh_yyb_capital()
    return {
        "上榜次数": yyb_most,
        "资金实力": yyb_capital
    }

def get_hot_money_tracking():
    """游资追踪（开盘啦数据）"""
    # 调用开盘啦API获取游资组合
    # 追踪六一中路、方新侠、赵老哥等席位
    pass
```

### 4.4 策略扫描增强

**新增功能：**

| 功能 | 说明 |
|-----|------|
| 情绪匹配 | 根据当前情绪周期自动调整策略 |
| 板块联动 | 判断板块效应，选择主流板块 |
| 游资参考 | 提示相关游资近期操作 |
| 实时预警 | 符合条件时推送通知 |

---

## 五、交易流程设计

### 5.1 盘前流程 (8:00-9:15)

```
1. 消息汇总
   ├── 开盘啦：隔夜消息、题材发酵
   └── 同花顺：外盘走势、期货表现

2. 情绪预判
   ├── 昨日涨停/跌停统计
   ├── 情绪阶段判断
   └── 制定当日策略

3. 板块选择
   ├── 主流板块确认
   ├── 资金流向分析
   └── 选定操作方向

4. 候选股筛选
   ├── 策略扫描初选
   ├── 板块内筛选
   └── 形态确认
```

### 5.2 盘中流程 (9:30-15:00)

```
1. 竞价观察
   ├── 开盘啦：竞价异动监控
   └── 开盘啦：板块竞价情况

2. 策略执行
   ├── 符合条件 → 买入
   ├── 不符合 → 等待
   └── 预警通知

3. 持仓监控
   ├── 价格波动跟踪
   ├── 止盈止损检查
   └── 卖点提醒
```

### 5.3 盘后流程 (15:00-17:00)

```
1. 数据更新
   ├── 获取收盘数据
   ├── 更新持仓盈亏
   └── 记录交易

2. 复盘分析
   ├── 开盘啦：复盘数据
   ├── 龙虎榜分析
   └── 游资动向追踪

3. 计划制定
   ├── 次日候选股
   ├── 策略调整
   └── 仓位安排
```

---

## 六、系统集成方案

### 6.1 APP数据接入

**开盘啦数据获取：**

| 功能 | 获取方式 | 说明 |
|-----|---------|------|
| 竞价异动 | 网页爬虫/API | 需定期抓取 |
| 实时龙虎榜 | 网页爬虫/API | 盘中实时 |
| 深度龙虎榜 | 会员API | 游资追踪 |
| 市场情绪 | 会员API | 量化指标 |

**短线王数据获取：**

| 功能 | 获取方式 | 说明 |
|-----|---------|------|
| AI选股 | 会员API | 次日推荐 |
| 竞价龙头 | 会员API | 当日信号 |
| 尾盘擒龙 | 会员API | 14:00信号 |

### 6.2 数据同步策略

```python
# 定时任务配置
CRON_JOBS = {
    "8:00": ["消息汇总", "情绪预判"],
    "9:00": ["竞价数据", "候选股准备"],
    "9:30-11:30": ["实时监控", "信号推送"],
    "13:00-15:00": ["实时监控", "信号推送"],
    "15:30": ["收盘数据更新"],
    "16:00": ["龙虎榜获取"],
    "20:00": ["复盘分析", "次日计划"],
}
```

---

## 七、实施路线图

### 阶段一：基础功能（1-2周）

- [ ] 集成AkShare数据获取
- [ ] 实现情绪周期计算
- [ ] 实现板块效应分析
- [ ] 增强策略扫描功能

### 阶段二：数据增强（2-3周）

- [ ] 接入开盘啦数据（网页爬虫）
- [ ] 实现游资追踪模块
- [ ] 实现龙虎榜分析
- [ ] 优化板块资金流

### 阶段三：智能化（3-4周）

- [ ] 预警系统开发
- [ ] 推送通知集成
- [ ] 自动化交易接口
- [ ] 绩效分析模块

### 阶段四：高级功能（4-6周）

- [ ] 开盘啦会员API对接
- [ ] 短线王数据接入
- [ ] Level 2数据集成
- [ ] AI辅助决策

---

## 八、注意事项

1. **合规性**：数据获取需遵守各平台使用条款
2. **稳定性**：增加重试机制，防止API失效
3. **数据备份**：重要数据本地备份
4. **风险控制**：人工复核为主，自动化仅作参考
5. **成本控制**：根据实际需求选择付费方案

---

## 九、总结

| 阶段 | 主要工作 | 预计时间 |
|-----|---------|---------|
| 基础 | AkShare集成 + 情绪周期 | 2周 |
| 增强 | 开盘啦数据 + 游资追踪 | 3周 |
| 智能 | 预警系统 + 自动化 | 3周 |
| 高级 | 会员API + Level 2 | 2周 |

**推荐实施顺序**：
1. 先实现免费数据的功能
2. 再接入开盘啦免费版数据
3. 根据需要升级付费功能

---

*本方案将持续更新，根据实际实施情况进行调整。*
